.\" Man page generated from reStructuredText.
.
.TH "PCOCC-BATCH" "1" "Apr 23, 2019" "0.6.0" "pcocc"
.SH NAME
pcocc-batch \- Instantiate or restore a virtual cluster (batch mode)
.
.nr rst2man-indent-level 0
.
.de1 rstReportMargin
\\$1 \\n[an-margin]
level \\n[rst2man-indent-level]
level margin: \\n[rst2man-indent\\n[rst2man-indent-level]]
-
\\n[rst2man-indent0]
\\n[rst2man-indent1]
\\n[rst2man-indent2]
..
.de1 INDENT
.\" .rstReportMargin pre:
. RS \\$1
. nr rst2man-indent\\n[rst2man-indent-level] \\n[an-margin]
. nr rst2man-indent-level +1
.\" .rstReportMargin post:
..
.de UNINDENT
. RE
.\" indent \\n[an-margin]
.\" old: \\n[rst2man-indent\\n[rst2man-indent-level]]
.nr rst2man-indent-level -1
.\" new: \\n[rst2man-indent\\n[rst2man-indent-level]]
.in \\n[rst2man-indent\\n[rst2man-indent-level]]u
..
.SH SYNOPSIS
.sp
pcocc batch [OPTIONS] [BATCH_OPTIONS]... CLUSTER_DEFINITION
.SH DESCRIPTION
.sp
Instantiate or restore a virtual cluster in batch mode. A cluster definition is expressed as a list of templates and counts. For example, pcocc batch \fItpl1:6,tpl2:2\fP instantiates a cluster with 6 VMs from template \fItpl1\fP and 2 VMs from template \fItpl2\fP\&. Resources  are relinquished when the VMs are powered off or when the batch script exits. Any data stored on ephemeral disks is lost after the job completes.
.sp
Batch options are passed on to the underlying batch manager (see sbatch(1)). By default batch jobs are submitted with the name \fIpcocc\fP unless specified otherwise in the batch options. pcocc commands which target a virtual cluster look for a job named \fIpcocc\fP and will select it if there is only one match. Otherwise, the id or name of the batch job hosting the cluster must be specified.
.sp
It is possible to execute a script on the first physical compute node with the \fI\-E\fP option or on the first VM with the \fI\-b\fP option. The latter requires that the pcocc guest agent is running in the VM.  The cluster will be terminated once the script exits. As in a \fIpcocc\-alloc(1)<alloc>\fP interactive shell, pcocc commands launched within a host script implicitely target the current pcocc cluster.
.SH OPTIONS
.INDENT 0.0
.INDENT 3.5
.INDENT 0.0
.TP
.B \-r, \-\-restart\-ckpt [DIR]
Restart cluster from the specified checkpoint
.TP
.B \-b, \-\-batch\-script [FILENAME]
Launch a batch script in the first VM
.TP
.B \-E, \-\-host\-script [FILENAME]
Launch a batch script on the first host
.TP
.B \-h, \-\-help
Show this message and exit.
.UNINDENT
.UNINDENT
.UNINDENT
.SH EXAMPLES
.SS Instanciate a new virtual cluster
.sp
For example to allocate eight VMs with four cores each with the \fIubuntu\fP job name, six from template \fItpl1\fP and two from \fItpl2\fP:
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
pcocc batch \-J ubuntu \-c 4 tpl1:6,tpl2:2
.ft P
.fi
.UNINDENT
.UNINDENT
.SS Restore a checkpointed cluster
.sp
The pcocc\-ckpt(1) command allows to save the state of a whole cluster (disks and memory) in a checkpoint. Assuming a cluster was submitted and checkpointed as follows:
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
$ pcocc batch \-c 8 myubuntu:3
Submitted batch job 311244
$ pcocc ckpt \-j 311244 ./savedbatch
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
To restore it from the checkpoint in batch mode:
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
pcocc batch \-c 8 \-r $PWD/savedbatch myubuntu:3
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
\fBWARNING:\fP
.INDENT 0.0
.INDENT 3.5
.INDENT 0.0
.IP \(bu 2
Make sure that the parameters in the restore command (core count, template types, ...) are the same that were used when the cluster was first submitted. The cluster also has to be restored on the same model of physical nodes as when it was first submitted.
.IP \(bu 2
The restore path must be an absolute path
.UNINDENT
.UNINDENT
.UNINDENT
.SH SEE ALSO
.sp
pcocc\-alloc(1), pcocc\-ckpt(1), pcocc\-template(1), pcocc\-templates.yaml(5)
.SH AUTHOR
François Diakhaté
.SH COPYRIGHT
2017
.\" Generated by docutils manpage writer.
.
